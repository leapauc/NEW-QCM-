<br />
<br />
<div class="center">
  <h1>DASHBOARD - Stagiaire {{ authNameUser }}</h1>

  <br /><br />
  <div class="row">
    <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
      <div class="card_3">
        <img src="img/icon_2_dashboard_admin.jpg" /><br /><br />
        <h2 class="fw-bold">{{ nbQuestionnairesRealises }}</h2>
        <h4>
          {{ 1 > 2 ? "questionnaires réalisés" : "questionnaire réalisé" }}
        </h4>
      </div>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
      <div class="card_3">
        <img src="img/happy_emoji.png" /><br /><br />
        <h2 class="fw-bold">{{ scoreMax }}</h2>
        <h4>score max</h4>
      </div>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
      <div class="card_3">
        <img src="img/sad_emoji.png" /><br /><br />
        <h2 class="fw-bold">{{ scoreMin }}</h2>
        <h4>score min</h4>
      </div>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
      <div class="card_3">
        <img src="img/average_icon.png" /><br /><br />
        <h2 class="fw-bold">{{ scoreAvg | number : "1.2-2" }}</h2>
        <h4>de moyenne</h4>
      </div>
    </div>
  </div>
  <hr />
  <div class="row text-center">
    <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
      <div class="card_3">
        <img src="img/ranking_icon.png" /><br /><br />
        <h2 class="fw-bold">{{ range }}</h2>
        <!-- 1 ? "ème" : "ère"-->
        <h4>place</h4>
      </div>
    </div>
    <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
      <div class="card_3">
        <img src="img/time_last.png" /><br /><br />
        <h2 class="fw-bold">{{ avgTime | timeFormat }}</h2>
        <h4>durée moyenne QCM</h4>
      </div>
    </div>

    <div class="col-6 d-flex justify-content-center">
      <div
        class="card_6 p-3 w-100 d-flex align-items-center justify-content-center"
      >
        <div class="row w-100">
          <div class="col-5 d-flex justify-content-center align-items-center">
            <img src="img/icon_5_dashboard_admin.png" class="img-fluid" />
          </div>
          <div
            class="col-5 offset-1 d-flex flex-column justify-content-center align-items-center"
          >
            <h4>Questionnaire le plus populaire :</h4>
            <h2 class="fw-bold">{{ questionnairePopulaire }}</h2>
          </div>
        </div>
      </div>
    </div>
  </div>
  <br />
  <hr />
  <!-- Tableau statistique sur les tentatives de réponses des utilisateurs -->
  <div class="center">
    <h3>Statistiques par tentatives de réponses au QCM</h3>
    <table class="table table-bordered table-striped align-middle text-center">
      <thead>
        <tr>
          <th>Nom QCM</th>
          <th>Finie à</th>
          <th>Durée</th>
          <th>Score</th>
          <th>Progression</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let attempt of paginatedAttempts">
          <td>{{ attempt.title }}</td>
          <td>{{ attempt.ended_at | date : "short" }}</td>
          <td *ngIf="attempt.duration.minutes">
            {{ attempt.duration.minutes }} min {{ attempt.duration.seconds }} s
          </td>
          <td *ngIf="!attempt.duration.minutes">
            {{ attempt.duration.seconds }} s
          </td>
          <td style="width: 200px">
            <div class="position-relative" style="height: 20px">
              <div class="progress h-100">
                <div
                  class="progress-bar"
                  role="progressbar"
                  [ngStyle]="{
                    width: attempt.score + '%',
                    backgroundColor: getCompletionColor(attempt.score)
                  }"
                  [attr.aria-valuenow]="attempt.score"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>
              <span
                class="position-absolute top-50 start-50 translate-middle fw-bold"
                style="color: black"
              >
                {{ attempt.score | number : "1.0-0" }}%
              </span>
            </div>
          </td>
          <td>
            <!-- Conteneur de la jauge -->
            <div class="position-relative" style="height: 20px">
              <!-- Barre de progression -->
              <div class="progress h-100">
                <div
                  class="progress-bar"
                  role="progressbar"
                  [ngStyle]="{
                    width: attempt.completed + '%',
                    backgroundColor: getCompletionColor(attempt.completed)
                  }"
                  [attr.aria-valuenow]="attempt.completed"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>

              <!-- Texte centré -->
              <span
                class="position-absolute top-50 start-50 translate-middle fw-bold"
                style="color: black"
              >
                {{ attempt.completed | number : "1.0-0" }}%
              </span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <!-- Pagination -->
    <app-pagination
      [items]="allAttemptsOfMyUser"
      [pageSize]="pageSize"
      (pageChange)="paginatedAttempts = $event"
    >
    </app-pagination>
  </div>
</div>
