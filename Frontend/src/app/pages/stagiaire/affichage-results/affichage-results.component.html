<br />
<br />
<div class="center">
  <h1>Affichage des résultats par tentative</h1>

  <br /><br />
  <p>
    Permet de consulter la liste des tentatives et visualiser les réponses
    données.
  </p>
  <p><i>Continu à pratiquer pour améliorer tes statistiques !</i></p>
  <br />
  <div class="table-responsive-custom">
    <table class="table table-striped">
      <thead>
        <tr>
          <th></th>
          <th>ID Tentative</th>
          <th>Score</th>
          <th>Progression</th>
          <th>Fin</th>
          <th>Durée (minutes)</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let attempt of attempts">
          <td>
            <i
              class="bi bi-eye text-success fs-5"
              (click)="viewAttempt(attempt.id_attempt)"
            ></i>
          </td>
          <td>{{ attempt.id_attempt }}</td>
          <td>
            {{ attempt.score }}
            <span *ngIf="attempt.score === 100" class="text-warning ms-1"
              >⭐</span
            >
          </td>
          <td>
            <!-- Conteneur de la jauge -->
            <div class="position-relative" style="height: 20px">
              <!-- Barre de progression -->
              <div class="progress h-100">
                <div
                  class="progress-bar"
                  role="progressbar"
                  [ngStyle]="{
                    width: attempt.completed + '%',
                    backgroundColor: getCompletionColor(attempt.completed)
                  }"
                  [attr.aria-valuenow]="attempt.completed"
                  aria-valuemin="0"
                  aria-valuemax="100"
                ></div>
              </div>

              <!-- Texte centré -->
              <span
                class="position-absolute top-50 start-50 translate-middle fw-bold"
                style="color: black"
              >
                {{ attempt.completed }}%
              </span>
            </div>
          </td>
          <td>{{ attempt.started_at | date : "short" }}</td>
          <td>
            {{
              getDurationMinutes(attempt.started_at, attempt.ended_at)
                | timeFormat
            }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  id="attemptModal"
  tabindex="-1"
  aria-labelledby="attemptModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content p-3">
      <div class="modal-body" *ngIf="selectedAttemptQuestions">
        <h3>Questionnaire</h3>
        <div *ngFor="let q of selectedAttemptQuestions" class="mb-3">
          <p>
            <b>{{ q.question }}</b>
          </p>
          <li
            class="list-group-item d-flex align-items-center"
            *ngFor="let resp of getResponses(qIndex).controls"
          >
            <input
              type="{{ question.type === 'single' ? 'radio' : 'checkbox' }}"
              [name]="'question' + qIndex"
              class="me-2"
            />
            {{ resp.value.position }}. {{ resp.value.response }}
          </li>
        </div>

        <button type="button" class="btn btn-primary" (click)="closeModal()">
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>
