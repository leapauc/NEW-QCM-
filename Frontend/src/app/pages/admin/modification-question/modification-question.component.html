<div class="center">
  <br /><br />
  <h1 class="text-center my-4">Modification question</h1>
  <br /><br />
  <p>Ce formulaire permet de modifier une question d'un questionnaire.</p>
  <br />
  <!-- Sélection QCM et Question -->
  <div class="row mb-4 form">
    <div class="col-5 offset-1">
      <label for="id_qcm" class="form-label">QCM</label>
      <select class="form-select" id="id_qcm" (change)="onQcmChange($event)">
        <option value="" disabled selected>-- Sélectionner un QCM --</option>
        <option *ngFor="let qcm of qcms" [value]="qcm.id_qcm">
          {{ qcm.title }}
        </option>
      </select>
    </div>

    <div class="col-5">
      <label for="id_question" class="form-label">Question</label>
      <select
        class="form-select"
        id="id_question"
        [(ngModel)]="selectedQuestionId"
        (change)="onQuestionChange($event)"
      >
        <option
          *ngFor="let question of questions"
          [value]="question.id_question"
        >
          {{ question.question }}
        </option>
      </select>
    </div>
  </div>

  <!-- Formulaire affiché seulement si une question est sélectionnée -->
  <form
    *ngIf="selectedQuestionId"
    [formGroup]="questionForm"
    (ngSubmit)="submitForm()"
    class="form"
  >
    <div class="mb-3">
      <h4 class="fw-bold">MODIFICATION</h4>
      <br />
      <label for="question" class="form-label fw-bold"
        >Intitulé de la question</label
      >
      <textarea
        id="question"
        class="form-control"
        formControlName="question"
      ></textarea>
      <div
        *ngIf="
          questionForm.get('question')?.touched &&
          questionForm.get('question')?.invalid
        "
        class="text-danger"
      >
        Le titre est requis.
      </div>
    </div>

    <!-- Réponses -->
    <h5 class="mt-4">Réponses :</h5>
    <div formArrayName="responses">
      <div
        *ngFor="let response of responses.controls; let i = index"
        [formGroupName]="i"
        class="row g-2 align-items-center mb-2"
      >
        <div class="col-8">
          <input
            type="text"
            class="form-control"
            placeholder="Réponse {{ i + 1 }}"
            formControlName="text"
          />
        </div>
        <div class="col-2 text-center">
          <input
            type="checkbox"
            class="form-check-input"
            formControlName="isCorrect"
          />
          <label class="form-check-label">Correct</label>
        </div>
        <div class="col-2 text-end">
          <button
            type="button"
            class="btn btn-outline-danger btn-sm"
            (click)="removeResponse(i)"
            [disabled]="responses.length <= minResponses"
          >
            ❌
          </button>
        </div>
      </div>
    </div>

    <!-- Ajouter une réponse -->
    <button
      type="button"
      class="btn btn-outline-primary btn-sm mt-2"
      (click)="addResponse()"
      [disabled]="responses.length >= maxResponses"
    >
      <i class="bi bi-plus-circle"></i> Ajouter une réponse
    </button>

    <div class="mt-4 text-center">
      <button type="button" class="btn btn-danger me-2" (click)="cancelForm()">
        Annuler
      </button>
      <button
        type="button"
        class="btn btn-secondary me-2"
        (click)="resetForm()"
      >
        <i class="bi bi-arrow-counterclockwise"></i> Réinitialiser
      </button>
      <button type="submit" class="btn btn-success">
        <i class="bi bi-save"></i> Enregistrer
      </button>
    </div>
  </form>
</div>
<!-- MODALS -->
<app-modal
  modalId="successModal"
  icon="✔️"
  message="Modification de la Question réalisée avec succès !"
></app-modal>
<app-modal
  modalId="unvalidModal"
  icon="❌"
  message="Le formulaire ne peut pas être validé : au moins une réponse doit être correcte."
></app-modal>
<app-modal
  modalId="failedModal"
  icon="❌"
  message="La modification de la Question a échoué !"
></app-modal>
