<br /><br />
<div class="center">
  <h1>Ajouter un questionnaire</h1>

  <br /><br />
  <p>Ce formulaire permet d'ajouter un questionnaire et ses questions.</p>
  <br />
  <br />

  <form [formGroup]="qcmForm" (ngSubmit)="submitForm()" class="form">
    <!-- Titre et Description -->
    <label>Titre du QCM</label>
    <input
      formControlName="title"
      class="form-control mb-2"
      placeholder="Titre"
    />
    <div
      *ngIf="qcmForm.get('title')?.touched && qcmForm.get('title')?.invalid"
      class="text-danger mb-2"
    >
      Le titre est requis.
    </div>

    <label>Description</label>
    <textarea
      formControlName="description"
      class="form-control mb-4"
      placeholder="Description"
    ></textarea>
    <div
      *ngIf="
        qcmForm.get('description')?.touched &&
        qcmForm.get('description')?.invalid
      "
      class="text-danger mb-2"
    >
      Une description est requise.
    </div>

    <!-- Bouton pour ajouter une question -->
    <button type="button" class="btn btn-primary mb-3" (click)="addQuestion()">
      <i class="bi bi-plus-circle"></i> Ajouter une question
    </button>

    <!-- Liste des questions dynamiques -->
    <div formArrayName="questions">
      <div
        *ngFor="let question of questions.controls; let qIndex = index"
        [formGroupName]="qIndex"
        class="mb-4 p-3 border rounded"
      >
        <label>Question {{ qIndex + 1 }}</label>
        <input
          formControlName="question"
          class="form-control mb-2"
          placeholder="IntitulÃ© de la question"
        />

        <h5>RÃ©ponses :</h5>
        <div formArrayName="responses">
          <div
            *ngFor="
              let response of getResponses(qIndex).controls;
              let rIndex = index
            "
            [formGroupName]="rIndex"
            class="row g-2 align-items-center mb-2"
          >
            <div class="col-8">
              <input
                formControlName="response"
                class="form-control"
                placeholder="RÃ©ponse"
              />
            </div>
            <div class="col-2 text-center">
              <input
                type="checkbox"
                formControlName="is_correct"
                class="form-check-input"
              />
            </div>
            <div class="col-2 text-end">
              <button
                type="button"
                class="btn btn-outline-danger btn-sm"
                (click)="removeResponse(qIndex, rIndex)"
                [disabled]="getResponses(qIndex).length <= minResponses"
              >
                âŒ
              </button>
            </div>
          </div>
        </div>

        <button
          type="button"
          class="btn btn-outline-primary btn-sm mt-2"
          (click)="addResponse(qIndex)"
          [disabled]="getResponses(qIndex).length >= maxResponses"
        >
          â• Ajouter une rÃ©ponse
        </button>
        <button
          type="button"
          class="btn btn-outline-secondary btn-sm mt-2 ms-2"
          (click)="removeQuestion(qIndex)"
        >
          ğŸ—‘ Supprimer la question
        </button>
      </div>
    </div>

    <button type="submit" class="btn btn-success mt-3">
      <i class="bi bi-save"></i> Enregistrer
    </button>
  </form>
</div>

<!-- MODALS pour feedback -->
<app-modal
  modalId="unvalidModal"
  icon="âŒ"
  message="Au moins une rÃ©ponse correcte par question est requise."
></app-modal>
<app-modal
  modalId="successModal"
  icon="âœ”ï¸"
  message="QCM crÃ©Ã© avec succÃ¨s !"
></app-modal>
<app-modal
  modalId="failedModal"
  icon="âŒ"
  message="La crÃ©ation du QCM a Ã©chouÃ© !"
></app-modal>
