<div class="center">
  <br /><br />
  <h1>Ajout question</h1>
  <br /><br />
  <p>Ce formulaire permet d'ajouter une/des question/s à un questionnaire.</p>
  <br />
  <!-- Formulaire question -->
  <form [formGroup]="questionForm" (ngSubmit)="submitForm()" class="form">
    <!-- Sélection QCM -->
    <div class="mb-3">
      <label for="id_qcm" class="form-label">QCM</label>
      <select class="form-select" id="id_qcm" (change)="onQcmChange($event)">
        <option value="" disabled selected>-- Sélectionner un QCM --</option>
        <option *ngFor="let qcm of qcms" [value]="qcm.id_qcm">
          {{ qcm.title }}
        </option>
      </select>
    </div>
    <div class="mb-3">
      <label for="question" class="form-label">Question</label>
      <textarea
        id="question"
        class="form-control"
        formControlName="question"
      ></textarea>
      <div
        *ngIf="
          questionForm.get('question')?.touched &&
          questionForm.get('question')?.invalid
        "
        class="text-danger"
      >
        Le titre est requis.
      </div>
    </div>

    <!-- Réponses -->
    <div formArrayName="responses">
      <h5>Réponses :</h5>
      <div
        *ngFor="let response of responses.controls; let i = index"
        [formGroupName]="i"
        class="row g-2 align-items-center mb-2"
      >
        <div class="col-8">
          <input
            type="text"
            class="form-control"
            placeholder="Réponse {{ i + 1 }}"
            formControlName="text"
          />
        </div>
        <div class="col-2 text-center">
          <input
            type="checkbox"
            class="form-check-input"
            formControlName="isCorrect"
          />
          <label class="form-check-label">Correct</label>
        </div>
        <div class="col-2 text-end">
          <button
            type="button"
            class="btn btn-outline-danger btn-sm"
            (click)="removeResponse(i)"
            [disabled]="responses.length <= minResponses"
          >
            ❌
          </button>
        </div>
      </div>

      <button
        type="button"
        class="btn btn-outline-primary btn-sm"
        (click)="addResponse()"
        [disabled]="responses.length >= maxResponses"
      >
        <i class="bi bi-plus-circle"></i> Ajouter une réponse
      </button>
    </div>

    <!-- Submit -->
    <div class="mt-4 text-center">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="questionForm.invalid"
      >
        <i class="bi bi-save"></i> Enregistrer
      </button>
    </div>
  </form>
</div>
<!-- MODALS -->
<app-modal
  modalId="successModal"
  icon="✔️"
  message="Ajout de la Question réalisée avec succès !"
></app-modal>
<app-modal
  modalId="unvalidModal"
  icon="❌"
  message="Le formulaire ne peut pas être validé : au moins une réponse doit être correcte."
></app-modal>
<app-modal
  modalId="failedModal"
  icon="❌"
  message="L'ajout de la Question a échoué !"
></app-modal>
